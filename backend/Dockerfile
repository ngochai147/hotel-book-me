# ============================
# üöÄ Build Stage
# ============================
FROM maven:3.9.8-eclipse-temurin-17 AS build
WORKDIR /app

# Copy file c·∫•u h√¨nh Maven v√† source code
COPY pom.xml .
COPY src ./src

# Build ·ª©ng d·ª•ng, b·ªè qua test
RUN mvn clean package -DskipTests

# ============================
# üèÉ Run Stage
# ============================
FROM openjdk:21-jdk-slim
WORKDIR /app

# Copy file JAR t·ª´ stage build sang stage run
COPY --from=build /app/target/*.jar app.jar

# Thi·∫øt l·∫≠p bi·∫øn m√¥i tr∆∞·ªùng cho MongoDB (Render s·∫Ω t·ª± thay gi√° tr·ªã)
ENV SPRING_DATA_MONGODB_URI=${SPRING_DATA_MONGODB_URI}
ENV SERVER_PORT=8080

EXPOSE 8080

# Ch·∫°y ·ª©ng d·ª•ng
ENTRYPOINT ["java","-jar","app.jar"]
